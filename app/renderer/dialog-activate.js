module.exports=webpackJsonp([31],{10:function(t,e){t.exports=require("fs")},15:function(t,e){t.exports=require("querystring")},16:function(t,e){t.exports=require("util")},23:function(t,e){t.exports=require("events")},25:function(t,e){t.exports=require("os")},26:function(t,e){t.exports=require("crypto")},31:function(t,e){t.exports=require("tty")},32:function(t,e){t.exports=require("net")},357:function(t,e,i){"use strict";var a=i(0);Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var s=a(i(12)),r=i(28),n=i(8),o=i(13),c=a(i(27)),u=i(21),l=i(19),d=a(i(14)),h=i(34),p=a(i(151)),g=i(127),f=i(6);function m(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),i.push.apply(i,a)}return i}function v(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?m(Object(i),!0).forEach(function(e){(0,s.default)(t,e,i[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):m(Object(i)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))})}return t}const b=(0,c.default)("dialog-activate");var k={data(){return{isLinux:"linux"===(0,g.getPlatform)(),isMAS:!1,refreshingPricingTable:!1,refreshingSubscriptionData:!1,refreshingSubscriptionDataUsingMAS:!1,purchasingProductIdUsingMAS:null,illustrationImageURL:this.$toResourceURL("static/assets/images/activate-dialog-headline.svg"),checkImageURL:this.$toResourceURL("static/images/activate-dialog-check.svg")}},created(){this.$safeRun(()=>this.refreshPricingTable()),(0,u.trackEvent)({eventCategory:"Activate",eventAction:"showActivateWindow"})},mounted(){this.pricing&&this.pricing.products||this.$loadResource("static/pre-cache/pricing.json").then(t=>{t&&this.updatePricing({pricing:JSON.parse(t)})}).catch(t=>{b.warn("Get pre cache fail.",t)}),this.checkWindowInMAS()},computed:v({},(0,r.mapState)("account",["user","token","primaryEmail","subscriptionDetails"]),{},(0,r.mapState)("cache",["pricing","MASProducts"]),{},(0,r.mapState)("activation",["masTransactionState"]),{},(0,r.mapGetters)("app",["serviceRegion"]),{},(0,r.mapGetters)("preferences",["appearance","language"]),{displayUser(){return this.user.startsWith("_xmind_")?this.primaryEmail:this.user},features(){return this.isMAS?[this.$T("Available on all platforms include macOS & iOS."),this.$T("Always use the latest version."),this.$T("Unlock full features of XMind.")]:this.pricing&&"features"in this.pricing?this.pricing.features[this.language]:[]},pricingItems(){if(this.pricing&&"products"in this.pricing){const t={cn:"cny",us:"usd"},e={cn:"¥",us:"$"};return this.pricing.products.map(i=>{return{formattedPrice:`${e[this.serviceRegion]}${i.price[t[this.serviceRegion]]}`,month:i.month,type:i.type||"bundle",per:i.month>6?this.$T("Year"):this.$T("6 Months")}}).sort((t,e)=>e.month-t.month)}return[]},masPricingTableItems(){return this.MASProducts&&2===this.MASProducts.length?this.MASProducts.map(t=>{const e=n.MAS_PRODUCT_MAP.bundleYearly===t.productIdentifier?12:6;return{formattedPrice:t.formattedPrice,month:e,productId:t.productIdentifier,per:e>6?this.$T("Year"):this.$T("6 Months")}}).sort((t,e)=>e.month-t.month):[]},disableMASPurchaseButton(){return!this.MASProducts.length||this.purchasingProductIdUsingMAS},hasLogin(){return Boolean(this.user)},stylesForUserBackground(){return{"background-color":"dark"===this.appearance?"rgb(64,64,64)":"rgb(236,236,236)"}},stylesForUserButton(){return this.appearance,{"--uk-button-active-color":"inherit","--uk-button-background":"rgba(0,0,0,0)","--uk-button-border":"rgba(0,0,0,0)"}}}),methods:v({},(0,r.mapMutations)({updatePricing:"cache/updatePricing",updateMASProducts:"cache/updateMASProducts"}),{differentLink(){d.default.fetch(o.XOS.GO_DIFFERENCE_TRIAL_FULLVERSION)},signIn(){this.$safeRun(()=>d.default.fetch(o.WINDOW_OPEN,{name:"dialog-signin"}).then(()=>window.close()))},async purchase(t){this.hasLogin?this.isMAS?this.purchaseUsingMAS(t):((0,u.trackEvent)({eventCategory:"Activate",eventAction:"clickSubscriptButton"+this.serviceRegion.toUpperCase(),eventName:t.type+t.month}),await d.default.fetch(o.XOS.GO_BUY,{params:{product:t.type,keyVersion:"90",account:this.user,token:this.token,piwikId:this.$store.state.app.deviceId,platform:(0,g.getPlatform)(),buildVersion:(0,p.default)("version"),extend:t.month}})):this.signIn()},async purchaseUsingMAS(t){const e=t.productId;this.purchasingProductIdUsingMAS=e,d.default.fetch(o.MAS_IAP_PURCHASE,{productId:e}).then(t=>{t||b.error("Product id is not valid:",e)}),(0,u.trackEvent)({eventCategory:"Activate",eventAction:"clickSubscriptButtonMAS"+this.serviceRegion.toUpperCase(),eventName:e})},async refreshSubscriptionData(){this.refreshingSubscriptionData=!0,(0,u.trackEvent)({eventCategory:"Activate",eventAction:"signinToActivate"+this.serviceRegion.toUpperCase()});try{let{license:t,rawData:e}=await d.default.fetch(o.XOS.DEVICE_BIND);await d.default.fetch(o.STORE_COMMIT,{mutations:[{type:"account/updateAccount",payload:{rawSubscriptionData:e}}]}),t.status===n.SUBSCRIPTION_SERVER_STATUS.VALID?(await d.default.fetch(o.WINDOW_OPEN,{name:"dialog-congratulate"}),window.close()):(t.status,n.SUBSCRIPTION_SERVER_STATUS.EXPIRED,await(0,h.showMessageBox)({message:this.$T("No subscription detected."),detail:this.$T("Unable to detect any valid subscription status, please subscribe XMind at first.")}))}catch(t){t.code===n.E_UNAUTHORIZED?(await d.default.fetch(o.STORE_COMMIT,{mutations:[{type:"account/clearAccount"}]}),await d.default.fetch(o.WINDOW_OPEN,{name:"dialog-signin"}),window.close()):t.code===n.E_DEVICE_UNBOUND||t.code===n.E_DEVICE_NUMBER_LIMITED?(await d.default.fetch(o.STORE_COMMIT,{mutations:[{type:"account/clearAccount"}]}),await(0,h.showMessageBox)({message:this.$T("Signed Out"),detail:this.$T("You have been signed out from this device. Please keep your account safe.")})):(b.warn("Failed to refresh subscription information:",t),await(0,h.showMessageBox)({message:this.$T("Unable to verify XMind ID."),detail:this.$T("Can’t connect with XMind server, please try again later.")}))}finally{this.refreshingSubscriptionData=!1}},async refreshPricingTable(){this.isMAS&&this.refreshMASPricingTable(),this.refreshingPricingTable=!0;try{const t=await d.default.fetch(o.XOS.BUY_PRICING_TABLE);t&&this.updatePricing({pricing:t})}catch(t){b.warn("Failed to load pricing table:",t)}finally{this.refreshingPricingTable=!1}},async refreshMASPricingTable(){d.default.fetch(o.MAS_IAP_REFRESH_PRICING_TABLE).then(()=>{}).catch(t=>{b.error("Refresh MAS pricing table:",(0,l.normalizeError)(t))})},async refreshSubscriptionDataUsingMAS(){if(!this.user)return await d.default.fetch(o.WINDOW_OPEN,{name:"dialog-signin"}),void window.close();(0,u.trackEvent)({eventCategory:"Activate",eventAction:"restorePurchased"+this.serviceRegion.toUpperCase()}),this.refreshingSubscriptionDataUsingMAS=!0;try{if(!await d.default.fetch(o.MAS_IAP_RESTORE_TRANSACTIONS))return;await this.checkReceipt()&&await this.refreshSubscriptionData()}catch(t){b.error("Restore MAS purchase:",(0,l.normalizeError)(t))}finally{this.refreshingSubscriptionDataUsingMAS=!1}},async checkReceipt(){try{const t=await d.default.fetch(o.MAS_IAP_CHECK_RECEIPT_VALID);return b.debug("license:",t),!0}catch(t){if(b.warn("warn:",(0,l.normalizeError)(t),t.data),500===t.code)await(0,h.showMessageBox)({message:this.$T("Can’t connect with XMind server, please try again later.")});else if(t.code===n.E_UNAUTHORIZED)await d.default.fetch(o.STORE_COMMIT,{mutations:[{type:"account/clearAccount"}]}),await d.default.fetch(o.WINDOW_OPEN,{name:"dialog-signin"});else if(t.data&&t.data.errorcode)if("4001"===t.data.errorcode)await(0,h.showMessageBox)({message:this.$T("Incorrect subscription information"),detail:this.$T("The software encountered some problems during license activation.")});else if("4002"===t.data.errorcode)await(0,h.showMessageBox)({message:this.$T("Invalid subscription information"),detail:this.$T("Subscription information failed to verify, please provide valid subscription information.")});else if("4003"===t.data.errorcode)await(0,h.showMessageBox)({message:this.$T("No subscription information detected"),detail:this.$T("You may not have purchased or your subscription has expired. Please subscribe now.")});else{if("4004"===t.data.errorcode)return await(0,h.showMessageBox)({message:this.$T("You've already subscribed.")}),!0;"4005"===t.data.errorcode&&await(0,h.showMessageBox)({message:this.$T("Purchase Failed"),detail:this.$T("Probably the currently signed in Apple ID has purchased this item, please try to sign in with another Apple ID.")})}else await(0,h.showMessageBox)({message:this.$T("Invalid purchase information."),detail:this.$T("Please confirm that you have successfully purchased this item with current Apple ID.")});return!1}},checkWindowInMAS(){if(!this.isMAS)return;const{isNeedResize:t,value:e}=this.calcNeedResizeWindowData();t&&this.adaptWindow(e)},adaptWindow(t=0){const e=f.remote.getCurrentWindow(),{width:i,height:a}=e.getBounds(),s=a+t,r=s/a*i;e.setSize(parseInt(r),parseInt(s)),setTimeout(()=>e.center(),10)},calcNeedResizeWindowData(){const{differentLink:t,priceButtonsContainer:e,masSubscriptionNotice:i}=this.$refs;if(!i)return{isNeedResize:!1,value:0};const a=i.getBoundingClientRect();if(e){const t=e.getBoundingClientRect();return{isNeedResize:t.bottom>a.top,value:t.bottom-a.top+5}}if(t){const e=75,i=t.getBoundingClientRect(),s=a.top-i.bottom;return{isNeedResize:s<e,value:e-s+5}}return{isNeedResize:!1,value:0}}}),watch:{async masTransactionState(t){if(t===n.MAS_TRANSACTION_STATE.PURCHASED){await this.checkReceipt()&&await this.refreshSubscriptionData(),await d.default.fetch(o.STORE_COMMIT,{mutations:[{type:"activation/updateMASTransactionState",payload:{transactionState:n.MAS_TRANSACTION_STATE.DEFAULT}}]}),this.purchasingProductIdUsingMAS=null}t===n.MAS_TRANSACTION_STATE.FAILED&&(this.purchasingProductIdUsingMAS=null)},language(t,e){this.isMAS&&t!==e&&(this.adaptWindow(0),setTimeout(()=>{this.checkWindowInMAS()},10))},masPricingTableItems(t,e){Array.isArray(t)&&t.length&&t!==e&&this.$nextTick(()=>{const{isNeedResize:t,value:e}=this.calcNeedResizeWindowData();t&&this.adaptWindow(e)})}}};e.default=k},4:function(t,e){t.exports=require("path")},6:function(t,e){t.exports=require("electron")},974:function(t,e,i){"use strict";var a=i(0),s=a(i(29)),r=a(i(975));(0,s.default)(r.default,{name:"dialog-activate"})},975:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=i(357),s=i.n(a);for(var r in a)"default"!==r&&function(t){i.d(e,t,function(){return a[t]})}(r);var n=i(976),o=i(1),c=Object(o.a)(s.a,n.a,n.b,!1,null,null,null);e.default=c.exports},976:function(t,e,i){"use strict";i.d(e,"a",function(){return a}),i.d(e,"b",function(){return s});var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"uk-window uk-window-dialog uk-window-default",attrs:{id:"app"}},[i("div",{staticClass:"uk-window-title-bar uk-window-title-bar-floating"},[i("window-control-button-group"),t._v(" "),i("div",{staticClass:"uk-window-title-bar-control-group-right uk-position-relative",staticStyle:{display:"block !important"}},[t.displayUser?i("div",{staticClass:"uk-button-group uk-margin-xsmall-right uk-margin-xsmall-top",staticStyle:{display:"inline-flex","border-radius":"3px"},style:t.stylesForUserBackground},[i("button",{staticClass:"uk-button uk-button-default uk-button-small uk-margin-small-right",staticStyle:{opacity:"0.5"},style:t.stylesForUserButton,attrs:{type:"button",title:t.$T("XMind ID")}},[t._v("\n          "+t._s(t.displayUser)+"\n        ")])]):t._e()])],1),t._v(" "),i("div",{staticClass:"uk-window-body uk-flex uk-flex-row"},[i("div",{staticClass:"uk-flex uk-height-1-1",staticStyle:{width:"39%"}},[i("div",{staticClass:"uk-preserve uk-background-cover uk-height-1-1 uk-width-1-1",attrs:{"data-src":t.illustrationImageURL,"uk-svg":""}})]),t._v(" "),i("div",{staticClass:"uk-panel uk-flex uk-flex-column uk-width-expand uk-margin-large-left uk-margin-xlarge-top uk-margin-large-right uk-margin-large-bottom"},[i("div",{staticClass:"uk-flex uk-flex-column uk-height-expand"},[i("h1",{staticClass:"uk-heading-primary uk-padding uk-padding-remove-horizontal uk-text-bold uk-margin-remove"},[t._v("\n          "+t._s(t.$T("Subscribe XMind"))+"\n        ")]),t._v(" "),i("h4",{staticClass:"uk-margin-remove uk-margin-small-bottom"},t._l(t.features,function(e,a){return i("div",{key:a},[i("div",[i("span",{staticClass:"uk-icon",attrs:{"data-src":t.checkImageURL,"uk-svg":""}}),t._v("\n              "+t._s(e)+"\n            ")])])}),0),t._v(" "),i("div",{ref:"differentLink",staticClass:"uk-margin-small-top"},[i("a",{staticClass:"uk-button-link uk-button",attrs:{draggable:"false",href:"#"},on:{click:function(e){return t.differentLink()}}},[t._v(t._s(t.$T("Differences Between Trial and Full Version")))])]),t._v(" "),i("div",{ref:"priceButtonsContainer",staticClass:"uk-flex uk-flex-between uk-margin-large-top"},t._l(t.isMAS?t.masPricingTableItems:t.pricingItems,function(e,a){return i("button",{key:a,staticClass:"uk-button uk-button-default uk-button-danger uk-width-expand",staticStyle:{height:"51px"},style:{marginRight:0===a?"20px":""},attrs:{type:"button",disabled:t.refreshingPricingTable||t.purchasingProductIdUsingMAS},on:{click:function(i){return t.purchase(e)}}},[i("div",{staticStyle:{position:"relative"}},[i("span",{staticClass:"uk-text-bold",staticStyle:{"font-size":"1.6rem","vertical-align":"text-bottom"}},[t._v(t._s(e.formattedPrice))]),t._v(" "),i("span",{staticStyle:{opacity:"0.8","font-size":"1.2rem"}},[t._v("/ "+t._s(e.per))]),t._v(" "),t.refreshingPricingTable||t.purchasingProductIdUsingMAS?i("span",{staticClass:"uk-icon",staticStyle:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)"},attrs:{"uk-spinner":""}}):t._e()])])}),0)]),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:!t.isMAS,expression:"!isMAS"}]},[i("div",{staticClass:"uk-margin-xsmall-bottom uk-text-muted uk-text-bold"},[t._v("\n          "+t._s(t.$T("Subscription Notice:"))+"\n        ")]),t._v(" "),i("div",{staticClass:"uk-text-small uk-text-muted"},[t._v("\n          "+t._s(t.$T("One subscription is allowed to activate XMind on 5 Mac/PCs, and XMind on 5 iOS/Android mobile devices."))+"\n          "+t._s(t.$T("Subscription can be cancelled anytime."))+"\n        ")]),t._v(" "),i("div",{staticClass:"uk-flex uk-flex-right uk-margin-large-top"},[t.user?i("button",{staticClass:"uk-button uk-button-default",attrs:{disabled:t.refreshingSubscriptionData},on:{click:t.refreshSubscriptionData}},[t._v("\n            "+t._s(t.refreshingSubscriptionData?t.$T("Checking..."):t.$T("Already Purchased"))+"\n          ")]):i("button",{staticClass:"uk-button uk-button-default",on:{click:t.signIn}},[t._v("\n            "+t._s(t.$T("Sign in to Activate"))+"\n          ")])])]),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:t.isMAS,expression:"isMAS"}],ref:"masSubscriptionNotice",staticClass:"uk-flex uk-flex-column uk-text-muted"},[i("div",{staticClass:"uk-text-bold"},[t._v("\n          "+t._s(t.$T("Subscription Notice:"))+"\n        ")]),t._v(" "),i("ul",{staticClass:"uk-list uk-margin-small-top uk-margin-small-bottom"},[i("li",{staticClass:"item uk-padding-remove-left uk-margin-remove-top uk-flex"},[i("span",{staticStyle:{"line-height":"1rem"}},[t._v("•")]),t._v(" "),i("span",{staticClass:"uk-margin-small-left uk-text-small"},[t._v(t._s(t.$T("One subscription is allowed to activate XMind on 5 Mac/PCs, and XMind on 5 mobile devices.")))])]),t._v(" "),i("li",{staticClass:"item uk-padding-remove-left uk-margin-remove-top uk-flex"},[i("span",{staticStyle:{"line-height":"1rem"}},[t._v("•")]),t._v(" "),i("span",{staticClass:"uk-margin-small-left uk-text-small"},[t._v(t._s(t.$T("After confirming your purchase, payment will be made through your iTunes account.")))])]),t._v(" "),i("li",{staticClass:"item uk-padding-remove-left uk-margin-remove-top uk-flex"},[i("span",{staticStyle:{"line-height":"1rem"}},[t._v("•")]),t._v(" "),i("span",{staticClass:"uk-margin-small-left uk-text-small"},[t._v(t._s(t.$T("Apple ID for automatic renewal subscriptions will be automatically charged for an additional 6 months in iTunes account 24 hours prior to the expiration of each billing cycle.")))])]),t._v(" "),i("li",{staticClass:"item uk-padding-remove-left uk-margin-remove-top uk-flex"},[i("span",{staticStyle:{"line-height":"1rem"}},[t._v("•")]),t._v(" "),i("span",{staticClass:"uk-margin-small-left uk-text-small"},[t._v(t._s(t.$T("You can cancel your subscription from your personal iTunes account during the subscription period. It is required to cancel the subscription at least 24 hours prior to the expiration of the existing plan.")))])])]),t._v(" "),i("div",{staticClass:"uk-flex uk-flex-between uk-margin-large-top"},[i("div",[i("a",{staticClass:"uk-margin-small-right",attrs:{draggable:"false",href:t.isMAS?"xos://GO_TERMS_MAS":"xos://GO_TERMS",target:"_blank"}},[t._v(t._s(t.$T("Terms of Service")))]),t._v(" "),i("a",{attrs:{draggable:"false",href:t.isMAS?"xos://GO_PRIVACY_MAS":"xos://GO_PRIVACY",target:"_blank"}},[t._v(t._s(t.$T("Privacy Policy")))])]),t._v(" "),i("button",{staticClass:"uk-button uk-button-default",attrs:{type:"button",disabled:t.refreshingSubscriptionDataUsingMAS},on:{click:t.refreshSubscriptionDataUsingMAS}},[t._v("\n            "+t._s(t.refreshingSubscriptionDataUsingMAS?t.$T("Checking...."):t.$T("Already Purchased"))+"\n          ")])])])])])])},s=[]}},[974]);